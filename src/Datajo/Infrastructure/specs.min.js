var Exception=function(){function n(n){this.message=n}return n.prototype.toString=function(){return"Datajo exception: "+this.message},n}(),_=function(){function n(){}return n.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"},n.isString=function(n){return toString.call(n)=="[object String]"},n.normalize=function(n){return n.trim().toLowerCase()},n}(),EventName=function(){function n(){}return n.events={click:function(){return!0},load:function(){return!0},submit:function(n){return _.normalize(n.tagName)==="form"}},n.extract=function(n,t){if(!t)throw new Exception("HTML element has not been provided");var i=_.isString(n.event)?_.normalize(n.event):"click";if(i===""&&(i="click"),this.events[i]===undefined)throw new Exception("Event "+i+" has not been recognized");if(this.events[i](t))return i;throw new Exception('Event "'+i+'" is not supported by "'+t.tagName+'" tag.');},n}(),Repository=function(){function n(){}return n.prototype.findNotConfiguredElements=function(){var n=[];return $("[data-jo]").each(function(t,i){i.datajo===undefined&&n.push(i)}),n},n}(),Configuration=function(){function n(){}return n}(),ActivityIndicator=function(){function n(n){var i=n.activityIndicator,t;i===undefined||i.trim()===""?(this.showMe=function(){},this.hideMe=function(){}):(t=$(i),t.hide(),this.showMe=function(){t.show()},this.hideMe=function(){t.hide()})}return n.prototype.show=function(){this.showMe()},n.prototype.hide=function(){this.hideMe()},n}(),ActionHandler=function(){function n(){}return n.prototype.execute=function(){},n}(),Action=function(){function n(n,t,i){if(i.action!==n)throw new Exception("'"+n+"' action expected");if(i.target===undefined||i.target.trim()==="")throw new Exception("Target of the action has not been defined");this.sender=t,this.action=i.action,this.target=i.target}return n}(),__extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ShowAction=function(n){function t(t,i){n.call(this,"show",t,i),this.duration=i.duration,this.easing=i.easing}return __extends(t,n),t}(Action),TargetResolver=function(){function n(){}return n.resolvers={_parent:function(n){return $(n.sender.parentNode)},_self:function(n){return $(n.sender)}},n.resolve=function(t){return n.resolvers[t.target]!==undefined?n.resolvers[t.target](t):$(t.target)},n}(),ShowActionHandler=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var i=new ShowAction(n,t),r=TargetResolver.resolve(i);r.show(i.duration===undefined?200:i.duration,i.easing===undefined?"linear":i.easing)},t}(ActionHandler),HideAction=function(n){function t(t,i){n.call(this,"hide",t,i),this.duration=i.duration,this.easing=i.easing}return __extends(t,n),t}(Action),HideActionHandler=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var i=new HideAction(n,t),r=TargetResolver.resolve(i);r.hide(i.duration===undefined?200:i.duration,i.easing===undefined?"linear":i.easing)},t}(ActionHandler),HtmlInjection=function(){function n(){}return n.injections={replaceContent:function(n,t){n.html(t)},afterContent:function(n,t){n.append(t)},beforeContent:function(n,t){n.prepend(t)},replaceTarget:function(n,t){n.replaceWith(t)},beforeTarget:function(n,t){n.before(t)},afterTarget:function(n,t){n.after(t)}},n.exists=function(t){return n.injections[t]!==undefined},n.inject=function(t,i){if(!n.exists(t.inject))throw new Exception("Unknown injection type: "+t.inject);n.injections[t.inject](TargetResolver.resolve(t),i)},n}(),AjaxAction=function(n){function t(t,i,r){if(n.call(this,t,i,r),r.url===undefined||r.url.trim()==="")throw new Exception("Url has not been defined");if(this.url=r.url,this.inject=r.inject===undefined||r.inject.trim()===""?"replaceContent":r.inject,!HtmlInjection.exists(this.inject))throw new Exception("Unknown injection type: "+this.inject);this.confirm=r.confirm}return __extends(t,n),t.prototype.confirmed=function(){return this.confirm===undefined||this.confirm.trim()===""||confirm(this.confirm)},t}(Action),GetAction=function(n){function t(t,i){n.call(this,"get",t,i)}return __extends(t,n),t}(AjaxAction),GetActionHandler=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var r=this,i=new GetAction(n,t);i.confirmed()&&$.get(i.url,function(n){r.onSuccess(i,n)})},t.prototype.onSuccess=function(n,t){HtmlInjection.inject(n,t)},t}(ActionHandler),PostAction=function(n){function t(t,i){if(n.call(this,"post",t,i),i.form===undefined||i.form.trim()==="")throw new Exception("Form has not been defined");var r=$(i.form).get(0);if(r.tagName.toLowerCase()!=="form")throw new Exception("Element identified by '"+i.form+"' selector is not a form");this.form=i.form}return __extends(t,n),t}(AjaxAction),PostActionHandler=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var r=this,i=new PostAction(n,t);i.confirmed()&&$.post(i.url,$(i.form).serializeArray(),function(n){r.onSuccess(i,n)})},t.prototype.onSuccess=function(n,t){HtmlInjection.inject(n,t)},t}(ActionHandler),Runner=function(){function n(){var n=this;$(document).ajaxStart(function(){return n.onAjaxStart()}),$(document).ajaxComplete(function(){return n.onAjaxComplete()}),$(document).ajaxError(function(t,i,r){return n.onAjaxError(t,i,r)}),this.repo=new Repository,this.handlers={show:new ShowActionHandler,hide:new HideActionHandler,get:new GetActionHandler,post:new PostActionHandler},this.activityIndicator=new ActivityIndicator(this.getConfiguration()),this.update()}return n.prototype.getConfiguration=function(){var n=$(document.body).data("jo-config");return n===undefined?new Configuration:n},n.prototype.update=function(){var u=this,t=this.repo.findNotConfiguredElements(),i,n,r;for(i in t){n=t[i],n.datajo=this.findData(n);for(r in n.datajo)$(n).on(r,function(n){return u.onevent(n)})}},n.prototype.onAjaxStart=function(){this.activityIndicator.show()},n.prototype.onAjaxComplete=function(){this.update(),this.activityIndicator.hide()},n.prototype.onAjaxError=function(n,t){(console!==undefined||n.type==="ajaxError")&&console.error("--- Datajo Ajax Error --- \n","Status:      "+t.status+"\nStatus Text: "+t.statusText+"\nResponse Text:\n"+t.responseText+"\n------------------------")},n.prototype.findData=function(n){var e,u,t,i,f,r;for(e in n.attributes)if(u=n.attributes[e],u.name==="data-jo"){if(t=JSON.parse(u.value),i={},_.isArray(t))for(f in t)r=EventName.extract(t[f],n),i[r]===undefined&&(i[r]=[]),i[r].push(t[f]);else i[EventName.extract(t,n)]=[t];return i}return undefined},n.prototype.onevent=function(n){var t,i;if(n.preventDefault(),n.target.datajo!==undefined){t=n.target.datajo[n.type];for(i in t)this.handlers[t[i].action].execute(n.target,t[i])}},n}();$(function(){var n=new Runner}),describe("EventName",function(){var n,t;beforeEach(function(){n=document.createElement("div"),t=document.createElement("form")}),describe("extract",function(){it("should throw exception if action has not been provided",function(){expect(function(){return EventName.extract(undefined,n)}).toThrow(),expect(function(){return EventName.extract(null,n)}).toThrow()}),it("should throw exception if HTML element has not been provided",function(){expect(function(){return EventName.extract({},undefined)}).toThrow(),expect(function(){return EventName.extract({},null)}).toThrow()}),it("should return 'click' event when action doesn't specify it",function(){expect(EventName.extract({},n)).toEqual("click"),expect(EventName.extract({event:undefined},n)).toEqual("click"),expect(EventName.extract({event:null},n)).toEqual("click"),expect(EventName.extract({event:""},n)).toEqual("click"),expect(EventName.extract({event:"   "},n)).toEqual("click")}),it("should throw exception if event name has not been recognized",function(){expect(function(){return EventName.extract({event:"invalid event"},n)}).toThrow()}),it("should ignore characters case",function(){expect(EventName.extract({event:"CLIck"},n)).toEqual("click"),expect(EventName.extract({event:"   cLIck "},n)).toEqual("click")}),it("should recognize 'click' event",function(){expect(EventName.extract({event:"click"},n)).toEqual("click")}),it("should recognize 'load' event",function(){expect(EventName.extract({event:"load"},n)).toEqual("load")}),it("should recognize 'submit' event",function(){expect(EventName.extract({event:"submit"},t)).toEqual("submit")}),it("should throw exception if 'submit' event has been applied to a HTML element different than <form>",function(){expect(function(){return EventName.extract({event:"submit"},n)}).toThrow()})})}),describe("Underscore",function(){describe("isArray",function(){it("should return false for everything what is not a JavaScript array",function(){expect(_.isArray(undefined)).toBeFalsy(),expect(_.isArray(null)).toBeFalsy(),expect(_.isArray(0)).toBeFalsy(),expect(_.isArray("some string")).toBeFalsy(),expect(_.isArray({})).toBeFalsy()}),it("should return true for the array",function(){expect(_.isArray([])).toBeTruthy(),expect(_.isArray([])).toBeTruthy()})}),describe("isString",function(){it("should return false for everything what is not a string",function(){expect(_.isString(undefined)).toBeFalsy(),expect(_.isString(null)).toBeFalsy(),expect(_.isString(0)).toBeFalsy(),expect(_.isString({})).toBeFalsy(),expect(_.isString([])).toBeFalsy()}),it("should return true for a string",function(){expect(_.isString("")).toBeTruthy(),expect(_.isString("some string")).toBeTruthy(),expect(_.isString(new String("some string"))).toBeTruthy()})}),describe("normalize",function(){it("should remove trailing white spaces from the string",function(){expect(_.normalize(" some string     ")).toEqual("some string"),expect(_.normalize("  ")).toEqual(""),expect(_.normalize("some string")).toEqual("some string")}),it("should make all characters lower case",function(){expect(_.normalize("Some String")).toEqual("some string"),expect(_.normalize("     Some String   ")).toEqual("some string")}),it("should throw exception if the string has not been provided",function(){expect(function(){return _.normalize(undefined)}).toThrow(),expect(function(){return _.normalize(null)}).toThrow()})})});