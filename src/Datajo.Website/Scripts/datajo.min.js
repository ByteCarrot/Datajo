var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},Datajo;(function(){var n=function(){function n(n){this.message=n}return n.prototype.toString=function(){return"Datajo exception: "+this.message},n}(),i=function(){function t(t,i,r){if(r.action!==t)throw new n("'"+t+"' action expected");if(r.target===undefined||r.target.trim()==="")throw new n("Target of the action has not been defined");this.sender=i,this.action=r.action,this.target=r.target}return t}(),t=function(){function n(){}return n.prototype.execute=function(){},n}(),s=function(n){function t(t,i){n.call(this,"show",t,i),this.duration=i.duration,this.easing=i.easing}return __extends(t,n),t}(i),h=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var i=new s(n,t),u=r.resolve(i);u.show(i.duration===undefined?200:i.duration,i.easing===undefined?"linear":i.easing)},t}(t),c=function(n){function t(t,i){n.call(this,"hide",t,i),this.duration=i.duration,this.easing=i.easing}return __extends(t,n),t}(i),l=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var i=new c(n,t),u=r.resolve(i);u.hide(i.duration===undefined?200:i.duration,i.easing===undefined?"linear":i.easing)},t}(t),r=function(){function n(){}return n.resolvers={_parent:function(n){return $(n.sender.parentNode)},_self:function(n){return $(n.sender)}},n.resolve=function(t){return n.resolvers[t.target]!==undefined?n.resolvers[t.target](t):$(t.target)},n}(),u=function(){function t(){}return t.injections={replaceContent:function(n,t){n.html(t)},afterContent:function(n,t){n.append(t)},beforeContent:function(n,t){n.prepend(t)},replaceTarget:function(n,t){n.replaceWith(t)},beforeTarget:function(n,t){n.before(t)},afterTarget:function(n,t){n.after(t)}},t.exists=function(n){return t.injections[n]!==undefined},t.inject=function(i,u){if(!t.exists(i.inject))throw new n("Unknown injection type: "+i.inject);t.injections[i.inject](r.resolve(i),u)},t}(),e=function(t){function i(i,r,f){if(t.call(this,i,r,f),f.url===undefined||f.url.trim()==="")throw new n("Url has not been defined");if(this.url=f.url,this.inject=f.inject===undefined||f.inject.trim()===""?"replaceContent":f.inject,!u.exists(this.inject))throw new n("Unknown injection type: "+this.inject);this.confirm=f.confirm}return __extends(i,t),i.prototype.confirmed=function(){return this.confirm===undefined||this.confirm.trim()===""||confirm(this.confirm)},i}(i),a=function(n){function t(t,i){n.call(this,"get",t,i)}return __extends(t,n),t}(e),v=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var r=this,i=new a(n,t);i.confirmed()&&$.get(i.url,function(n){r.onSuccess(i,n)})},t.prototype.onSuccess=function(n,t){u.inject(n,t)},t}(t),y=function(t){function i(i,r){if(t.call(this,"post",i,r),r.form===undefined||r.form.trim()==="")throw new n("Form has not been defined");var u=$(r.form).get(0);if(u.tagName.toLowerCase()!=="form")throw new n("Element identified by '"+r.form+"' selector is not a form");this.form=r.form}return __extends(i,t),i}(e),p=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var r=this,i=new y(n,t);i.confirmed()&&$.post(i.url,$(i.form).serializeArray(),function(n){r.onSuccess(i,n)})},t.prototype.onSuccess=function(n,t){u.inject(n,t)},t}(t),w=function(){function n(){}return n.prototype.findNotConfiguredElements=function(){var n=[];return $("[data-jo]").each(function(t,i){i.datajo===undefined&&n.push(i)}),n},n}(),b=function(){function n(){}return n}(),k=function(){function n(n){var i=n.activityIndicator,t;i===undefined||i.trim()===""?(this.showMe=function(){},this.hideMe=function(){}):(t=$(i),t.hide(),this.showMe=function(){t.show()},this.hideMe=function(){t.hide()})}return n.prototype.show=function(){this.showMe()},n.prototype.hide=function(){this.hideMe()},n}(),f=function(){function n(){}return n.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"},n.isString=function(n){return toString.call(n)=="[object String]"},n.normalize=function(n){return n.trim().toLowerCase()},n}(),o=function(){function t(){}return t.events={click:function(){return!0},load:function(){return!0},submit:function(n){return n.tagName==="form"}},t.nameOrDefault=function(t,i){var r=this.getEvent(t);if(this.isSupported(r,i))return r;throw new n('Event "'+r+'" is not supported by "'+i.tagName+'" tag.');},t.getEvent=function(t){if(t.event===undefined||t.event===null||!f.isString(t.event))return"click";var i=f.normalize(t.event);if(i==="")return"click";if(this.events[i]===undefined)throw new n("Event "+i+" is not supported");return i},t.isSupported=function(n,t){return this.events[n]===undefined?!1:this.events[n](t)},t}(),d=function(){function n(){var n=this;$(document).ajaxStart(function(){return n.onAjaxStart()}),$(document).ajaxComplete(function(){return n.onAjaxComplete()}),$(document).ajaxError(function(t,i,r){return n.onAjaxError(t,i,r)}),this.repo=new w,this.handlers={show:new h,hide:new l,get:new v,post:new p},this.activityIndicator=new k(this.getConfiguration()),this.update()}return n.prototype.getConfiguration=function(){var n=$(document.body).data("jo-config");return n===undefined?new b:n},n.prototype.update=function(){var u=this,t=this.repo.findNotConfiguredElements(),i,n,r;for(i in t){n=t[i],n.datajo=this.findData(n);for(r in n.datajo)$(n).on(r,function(n){return u.onevent(n)})}},n.prototype.onAjaxStart=function(){this.activityIndicator.show()},n.prototype.onAjaxComplete=function(){this.update(),this.activityIndicator.hide()},n.prototype.onAjaxError=function(n,t){(console!==undefined||n.type==="ajaxError")&&console.error("--- Datajo Ajax Error --- \n","Status:      "+t.status+"\nStatus Text: "+t.statusText+"\nResponse Text:\n"+t.responseText+"\n------------------------")},n.prototype.findData=function(n){var s,u,t,i,e,r;for(s in n.attributes)if(u=n.attributes[s],u.name==="data-jo"){if(t=JSON.parse(u.value),i={},f.isArray(t))for(e in t)r=o.getEvent(t[e]),i[r]===undefined&&(i[r]=[]),i[r].push(t[e]);else i[o.getEvent(t)]=[t];return i}return undefined},n.prototype.onevent=function(n){var t,i;if(n.preventDefault(),n.target.datajo!==undefined){t=n.target.datajo[n.type];for(i in t)this.handlers[t[i].action].execute(n.target,t[i])}},n}();$(function(){var n=new d})})(Datajo||(Datajo={}));